#!/bin/bash

LOCAL_SOURCE_DIR=${HOME}

if [ -z "$SWARM_JAR" ]; then
  SWARM_JAR="target/*-swarm.jar"
fi

BIND_IP=`ip addr | grep 'state UP' -A2 | tail -n1 | awk '{print $2}' | cut -f1  -d'/'`

export OPENSHIFT_KUBE_PING_NAMESPACE=$OPENSHIFT_BUILD_NAMESPACE

cat > $LOCAL_SOURCE_DIR/logging.properties <<EOF
handlers = java.util.logging.ConsoleHandler
.level = WARNING
java.util.logging.ConsoleHandler.level = FINEST
org.jgroups = FINEST
EOF

exec java -Djava.util.logging.config.file=$LOCAL_SOURCE_DIR/logging.properties -Djboss.bind.address=$BIND_IP -Djboss.http.port=8080 -Djboss.socket.binding.port-offset=0 -Djava.net.preferIPv4Stack=true -jar $LOCAL_SOURCE_DIR/$SWARM_JAR
